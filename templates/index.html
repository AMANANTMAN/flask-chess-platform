<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chessboard JS</title>
    <!-- CSS file -->
    <link rel="stylesheet" href="static/css/chessboard-0.3.0.min.css">
    <!-- Javascript files -->
    <script src="static/js/jquery.min.js"></script>
    <script src="static/js/chessboard-0.3.0.min.js"></script>  
</head>
<body>
    <div id="board" style='width: 400px'></div>

    <p id="pgn">{{ pgn }}</p>

    <script type='text/javascript'>
    var board = ChessBoard('board', {
        position: '{{ fen }}',
        showNotation: true,
        draggable: true,
        onDrop: onDrop
    });

  function onDrop(source, target, piece) {
  var pn = piece.includes('b') ? piece.toUpperCase().substring(1, 2) : piece.substring(1, 2);
  pn = piece.includes('P') ? '' : pn;
  var move = piece.includes("P") ? source + target : pn  + source.substring(0, 1) + target;
  move = piece.includes("P") && target.includes("8") ? target.substring(0, 1) + "8Q" : move; // pawn promotion

  $.get('/move', {'move': move}, function(data) {
    console.log(data);
    //var json_data = $.parseJSON(data);
    //console.log(data);
    //console.log(json_data.pgn);
      document.querySelector("#pgn").innerText = data.pgn;
      board.position(data.fen);
    });
  };

    </script>
</body>
</html>


